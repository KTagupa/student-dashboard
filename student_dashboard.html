<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple spinning loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md mx-auto p-4">
        <!-- Login Container -->
        <div id="login-container" class="bg-white p-8 rounded-xl shadow-lg transition-opacity duration-500">
            <h1 class="text-2xl font-bold text-gray-800 text-center mb-2">Student Dashboard</h1>
            <p class="text-center text-gray-500 mb-6">Please enter your credentials to view your performance.</p>
            
            <div id="setup-instructions" class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 hidden">
                <h3 class="font-bold mb-2">Teacher Setup Instructions</h3>
                <ol class="list-decimal list-inside text-sm space-y-2">
                    <li><strong>Prepare your Google Sheet:</strong> Create a sheet with columns like `StudentID`, `Password`, `StudentName`, `Subject1`, `Grade1`, etc.</li>
                    <li><strong>Publish your sheet:</strong> In Google Sheets, go to `File` > `Share` > `Publish to web`.</li>
                    <li>In the dialog, select the specific sheet, and choose `Comma-separated values (.csv)`.</li>
                    <li>Click `Publish` and copy the generated URL.</li>
                    <li><strong>Paste the URL</strong> into the `GOOGLE_SHEET_URL` variable in the `&lt;script&gt;` tag of this HTML file.</li>
                </ol>
            </div>

            <form id="login-form">
                <div class="mb-4">
                    <label for="student-id" class="block text-sm font-medium text-gray-700 mb-1">Student Number</label>
                    <input type="text" id="student-id" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 12345" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="••••••••" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center justify-center">
                    <span id="login-button-text">Login</span>
                    <div id="loader" class="loader hidden ml-2"></div>
                </button>
            </form>
            <p id="login-error" class="text-red-500 text-sm mt-4 text-center"></p>
        </div>

        <!-- Dashboard Container (hidden by default) -->
        <div id="dashboard-container" class="bg-white p-8 rounded-xl shadow-lg transition-opacity duration-500 opacity-0 hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Welcome, <span id="student-name" class="text-blue-600"></span>!</h1>
                    <p class="text-gray-500">Here is your performance summary.</p>
                </div>
                <button id="logout-button" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 text-sm">Logout</button>
            </div>
            
            <div id="performance-data" class="space-y-4">
                <!-- Performance data will be dynamically inserted here -->
                <div class="text-center text-gray-400 p-8">Loading data...</div>
            </div>
        </div>
    </div>

    <script>
        // --- TEACHER CONFIGURATION ---
        // PASTE YOUR GOOGLE SHEET PUBLISHED CSV URL HERE
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRlZYsuimLdlGnVyY4BKJWGTXIcobaAhlo8bnAKnnT1pN-2IzBCcQOyA5TRHQy4aeyrXxXdMmIbsvxJ/pub?gid=0&single=true&output=csv'; 
        // Example: 'https://docs.google.com/spreadsheets/d/e/2PACX-1v.../pub?gid=0&single=true&output=csv'

        // --- DOM ELEMENTS ---
        const loginContainer = document.getElementById('login-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        const loginForm = document.getElementById('login-form');
        const studentIdInput = document.getElementById('student-id');
        const passwordInput = document.getElementById('password');
        const loginError = document.getElementById('login-error');
        const setupInstructions = document.getElementById('setup-instructions');
        
        const loader = document.getElementById('loader');
        const loginButtonText = document.getElementById('login-button-text');

        const studentNameSpan = document.getElementById('student-name');
        const performanceDataDiv = document.getElementById('performance-data');
        const logoutButton = document.getElementById('logout-button');

        // --- CORE LOGIC ---

        // Check if the URL is set. If not, show instructions to the teacher.
        if (!GOOGLE_SHEET_URL || GOOGLE_SHEET_URL === '') {
            setupInstructions.classList.remove('hidden');
            loginError.textContent = "Teacher: Please configure the Google Sheet URL first.";
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const studentId = studentIdInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!studentId || !password) {
                loginError.textContent = 'Please enter both student number and password.';
                return;
            }

            loginError.textContent = '';
            setLoading(true);

            try {
                // 1. Fetch data from Google Sheet
                const response = await fetch(GOOGLE_SHEET_URL);
                if (!response.ok) {
                    throw new Error('Could not fetch the data sheet. Check the URL.');
                }
                const csvText = await response.text();
                
                // 2. Parse CSV data
                const data = parseCSV(csvText);
                
                // 3. Find the student
                // Assumes first row is headers
                const headers = data[0];
                const studentIdIndex = headers.findIndex(h => h.toLowerCase().trim() === 'studentid');
                const passwordIndex = headers.findIndex(h => h.toLowerCase().trim() === 'password');

                if (studentIdIndex === -1 || passwordIndex === -1) {
                    throw new Error('Your Google Sheet must have "StudentID" and "Password" columns.');
                }

                let foundStudent = null;
                for (let i = 1; i < data.length; i++) {
                    const row = data[i];
                    if (row[studentIdIndex] === studentId && row[passwordIndex] === password) {
                        foundStudent = {};
                        headers.forEach((header, index) => {
                            foundStudent[header.trim()] = row[index];
                        });
                        break;
                    }
                }

                // 4. Handle login result
                if (foundStudent) {
                    displayDashboard(foundStudent);
                } else {
                    loginError.textContent = 'Invalid student number or password. Please try again.';
                }

            } catch (error) {
                loginError.textContent = `Error: ${error.message}`;
                console.error(error);
            } finally {
                setLoading(false);
            }
        });

        logoutButton.addEventListener('click', () => {
            dashboardContainer.classList.add('opacity-0', 'hidden');
            loginContainer.classList.remove('opacity-0', 'hidden');
            studentIdInput.value = '';
            passwordInput.value = '';
        });

        function displayDashboard(studentData) {
            studentNameSpan.textContent = studentData.StudentName || 'Student';
            
            // Clear previous data
            performanceDataDiv.innerHTML = '';

            const performanceGrid = document.createElement('div');
            performanceGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';

            // Filter out identifying keys to not display them on the dashboard
            const displayableKeys = Object.keys(studentData).filter(key => 
                !['studentid', 'password', 'studentname'].includes(key.toLowerCase())
            );

            if (displayableKeys.length === 0) {
                 performanceDataDiv.innerHTML = '<p class="text-center text-gray-500">No performance data found for you.</p>';
            } else {
                displayableKeys.forEach(key => {
                    const value = studentData[key];
                    const card = document.createElement('div');
                    card.className = 'bg-gray-50 p-4 rounded-lg border';
                    card.innerHTML = `
                        <p class="text-sm text-gray-500 font-medium">${key}</p>
                        <p class="text-xl font-semibold text-gray-800">${value}</p>
                    `;
                    performanceGrid.appendChild(card);
                });
                performanceDataDiv.appendChild(performanceGrid);
            }

            loginContainer.classList.add('opacity-0', 'hidden');
            dashboardContainer.classList.remove('hidden');
            setTimeout(() => dashboardContainer.classList.remove('opacity-0'), 50); // For smooth transition
        }

        function setLoading(isLoading) {
            if (isLoading) {
                loader.classList.remove('hidden');
                loginButtonText.classList.add('hidden');
                loginForm.querySelector('button').disabled = true;
            } else {
                loader.classList.add('hidden');
                loginButtonText.classList.remove('hidden');
                loginForm.querySelector('button').disabled = false;
            }
        }
        
        /**
         * A simple CSV parser.
         * @param {string} csvText The raw CSV text.
         * @returns {Array<Array<string>>} An array of rows, where each row is an array of cells.
         */
        function parseCSV(csvText) {
            const rows = csvText.trim().split('\n');
            return rows.map(row => row.split(',').map(cell => cell.trim()));
        }

    </script>
</body>
</html>
